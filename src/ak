#!/bin/bash
#@@BUILD_EXCLUDE_START
#@@HEADER_START
#!/bin/bash
export LANG=C.UTF-8
export LC_ALL=C.UTF-8
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ADB extensions kit (ak) - Main Entry Point
# ADBë¥¼ í™œìš©í•˜ì—¬ ì•ˆë“œë¡œì´ë“œ ê°œë°œì„ ì§€ì›í•˜ëŠ” CLI ë„êµ¬
#
# ğŸ§‘â€ğŸ’» ì‘ì„±ì: Claude Hwang
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#@@HEADER_END

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "${SCRIPT_DIR}/bootstrap.sh"
debug_init
#@@BUILD_EXCLUDE_END

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë„ì›€ë§
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

show_help() {
  echo
  echo -e "${CYAN}${BOLD}Usage:${NC} ak <command> [arguments...]"
  echo
  echo -e "${BOLD}Commands:${NC}"
  echo -e "  ${BOLD}install${NC} [options] [apk_files...] Install APK files"
  echo -e "  ${BOLD}pull${NC} [package] [filename]        Pull APK from device"
  echo -e "  ${BOLD}info${NC} [package]                   Show app information"
  echo -e "  ${BOLD}permissions${NC} [package]            List app permissions"
  echo -e "  ${BOLD}uninstall${NC} [package]              Uninstall app"
  echo -e "  ${BOLD}clear${NC} [packages...]              Clear app data"
  echo -e "  ${BOLD}kill${NC} [packages...]               Force-stop app"
  echo -e "  ${BOLD}launch${NC} <package>                 Launch app"
  echo -e "  ${BOLD}signature${NC} [package|apk]          Show signature"
  echo -e "  ${BOLD}activities${NC} [--all]               Show activity stack"
  echo -e "  ${BOLD}devices${NC}                          List connected devices"
  echo
  echo -e "${BOLD}Global Options:${NC}"
  echo -e "  ${BOLD}--version, -v${NC}    Show version"
  echo -e "  ${BOLD}--help, -h${NC}       Show this help"
  echo
  echo -e "Run '${BOLD}ak <command> --help${NC}' for command-specific help."
  echo
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ë©”ì¸ ë¼ìš°íŒ…
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

main() {

  # ADB í•„ìˆ˜ ì²´í¬
  if ! check_adb_available; then
    exit 1
  fi
  
  # ì¸ì ì—†ìœ¼ë©´ ë„ì›€ë§
  if [ $# -eq 0 ]; then
    show_help
    exit 0
  fi

  local command=$1
  shift

  case "$command" in
    # ê¸€ë¡œë²Œ ì˜µì…˜
    --version|-v)
      show_version
      ;;
    --help|-h)
      show_help
      ;;
    
    # ë‹¤ë¥¸ ì»¤ë§¨ë“œë“¤ (ë™ì  ë¡œë“œ ë˜ëŠ” ì´ë¯¸ ë¡œë“œë¨)
    install|pull|info|permissions|uninstall|clear|kill|launch|signature|activities|devices)
      # ê°œë°œ ëª¨ë“œ: load_command í•¨ìˆ˜ ì¡´ì¬ ì‹œ ë™ì  ë¡œë“œ
      if declare -f load_command >/dev/null 2>&1; then
        if ! load_command "$command"; then
          echo -e "${ERROR} Command module not found: $command"
          exit 1
        fi
      fi
      
      # ë‹¨ìˆœíˆ ì»¤ë§¨ë“œ í˜¸ì¶œ (ì˜µì…˜ ê²€ì¦, ë””ë°”ì´ìŠ¤ ì„ íƒ ë“±ì€ ê° ì»¤ë§¨ë“œì—ì„œ ì²˜ë¦¬)
      "cmd_${command}" "$@"
      ;;
    
    *)
      echo -e "${ERROR} Unknown command: $command"
      echo
      show_help
      exit 1
      ;;
  esac
}

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
main "$@"
